<Window x:Class="SimTestRequestBridge.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SimTestRequestBridge"
        xmlns:vm1="clr-namespace:SimTestRequestBridge.ViewModels" 
        xmlns:clr="clr-namespace:System;assembly=System.Runtime" 
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase" xmlns:controls="clr-namespace:SimTestRequestBridge.Controls"
        mc:Ignorable="d"
        Title="Sim Test Request Bridge" Height="759" Width="1174" >
    <Window.DataContext>
        <vm1:MainWindowViewModel></vm1:MainWindowViewModel>
    </Window.DataContext>

    <Window.Resources>
        <CollectionViewSource x:Key="CurrentWorkingRunsCollectionView"  Source="{Binding CurrentWorkingTestRequestRuns}"
                          IsLiveSortingRequested="True">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="RunNumber" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
            <CollectionViewSource.LiveSortingProperties>
                <clr:String>RunNumber</clr:String>
            </CollectionViewSource.LiveSortingProperties>
        </CollectionViewSource> 

        <Style x:Key="MyBorderStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="White" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="3" />
        </Style>

        <vm1:FileFromPathConverter x:Key="FileFromPathConverter" />

        <SolidColorBrush x:Key="clBr" Color="LightBlue" />
    </Window.Resources>
    
    <DockPanel>
        <ToolBarTray DockPanel.Dock="Top"  >
            <ToolBar>
                <Button Command="{Binding NewCommand}"  Content="New" />
                <Button Command="{Binding DeleteTestRequestCommand}"  Content="Delete" />
                <Button Command="{Binding RefreshCommand}" Content="Refresh" />
                <Button Command="{Binding SaveCommand}" Content="Save" />
                <Button Command="{Binding StageCommand}" Content="Stage" />
                <Button  Content="Import" />

            </ToolBar>
        </ToolBarTray>

        <Grid Name="MCGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition />
            </Grid.RowDefinitions>

            <Expander Grid.Column="0"  Background="Gray" FlowDirection="RightToLeft" ExpandDirection="Right" IsExpanded="True" >
                <DockPanel Background="LightGray" FlowDirection="LeftToRight" >
                    <GroupBox DockPanel.Dock="Top" Header="Test Requests - In Process" >
                        <DataGrid Name="inProcessTestRequestDataGrid" Margin="5" FlowDirection="LeftToRight" MinWidth="200" MinHeight="300"   Background="LightGray"  AutoGenerateColumns="False" HeadersVisibility="Column" IsReadOnly="True" SelectionMode="Single"  SelectedItem="{Binding CurrentSelectedTestRequest}" ItemsSource="{Binding Path=TestRequests, Mode=OneWay, NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}"  >
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Path=TestRequestID}"/>
                                <DataGridTextColumn Header="Car" Binding="{Binding Path=Car.Description}"/>
                                <DataGridTextColumn Header="Submitted" Binding="{Binding Path=RecievedTime}" SortDirection="Ascending"/>
                            </DataGrid.Columns>
                            <DataGrid.Resources>
                                <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="DarkGray"/>
                            </DataGrid.Resources>
                        </DataGrid>
                    </GroupBox>
                   
                </DockPanel>
            </Expander>

            <DockPanel Background="LightGray" Grid.Column="2"  IsEnabled="{Binding CurrentWorkingTestRequest, TargetNullValue=False}">
                <Grid DockPanel.Dock="Top">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="300" />
                    </Grid.RowDefinitions>
                    <GroupBox Header="Test Request - General Information"  Grid.Column="0"  >
                        <TabControl Margin="5" Background="AliceBlue">
                            <TabItem Header="Information">
                                <DockPanel Height="Auto" Name="stackPanel1" Width="Auto" LastChildFill="True" Margin="5">
                                    <Label DockPanel.Dock="Top">Request Name:</Label>
                                    <TextBlock  DockPanel.Dock="Top" HorizontalAlignment="Stretch"  Text="{Binding CurrentWorkingTestRequest.TestRequestID}" Background="White"  />
                                    <Label DockPanel.Dock="Top">Request Vehicle:</Label>
                                    <TextBlock  DockPanel.Dock="Top" HorizontalAlignment="Stretch"  Text="{Binding CurrentWorkingTestRequest.Car.Description}" Background="White"  />
                                    <Label DockPanel.Dock="Top" Grid.Column="0" Grid.Row="0" >Request Description:</Label>
                                    <TextBlock  HorizontalAlignment="Stretch"  Text="{Binding CurrentWorkingTestRequest.Description}" Background="White"  />
                                </DockPanel>
                            </TabItem>
                            <TabItem Header="Vehicle Setup">
                                <StackPanel Margin="10">
                                    <Label DockPanel.Dock="Top">Request Vehicle:</Label>
                                    <TextBlock  DockPanel.Dock="Top" HorizontalAlignment="Stretch"  Text="{Binding CurrentWorkingTestRequest.Car.Description}" Background="White"  />
                                    <Label >Vehicle Send File</Label>
                                    <DockPanel  LastChildFill="True" >
                                        <Button Content="Browse"  DockPanel.Dock="Left" VerticalAlignment="Center" Click="Button_ClickAsync"/>
                                        <TextBlock HorizontalAlignment="Stretch" Margin="5,1,1,1" Text="{Binding CurrentWorkingTestRequest.SendFilePath, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource FileFromPathConverter}}" Background="White"  />
                                    </DockPanel >
                                </StackPanel>
                            </TabItem>
                            <TabItem Header="OTHER??" >
                                <StackPanel Margin="10" Grid.Column="0">
                                    <Button Command="{Binding OpenStagingFolderCommand}"  Content="Open Staging Folder" Click="Button_Click" />
                                </StackPanel>
                            </TabItem>
                        </TabControl>
                    </GroupBox>
                    <GroupBox Header="Test Request - Runs" Grid.Column="1"  >
                        <DockPanel Background="LightGray" Grid.Column="2" Margin="5"  IsEnabled="{Binding CurrentWorkingTestRequest, TargetNullValue=False}">
                            <ToolBarTray DockPanel.Dock="Top" >
                                <ToolBar>
                                    <Button Command="{Binding NewRunCommand}"  Content="New" />
                                    <Button Command="{Binding DeleteTestRequestRunCommand}"  Content="Delete" />
                                    <Button Command="{Binding OrderRunUpCommand}" Content="Up" />
                                    <Button Command="{Binding OrderRunDownCommand}"  Content="Down" />
                                </ToolBar>
                            </ToolBarTray>
                            <controls:CustomDataGrid Background="LightGray" x:Name="runDataGrid"  AutoGenerateColumns="False" HeadersVisibility="Column" IsReadOnly="True"  SelectedItem="{Binding CurrentTestRequestRun}" ItemsSource="{Binding Source={StaticResource CurrentWorkingRunsCollectionView}}">
                                <!--ItemsSource="{Binding CurrentWorkingTestRequest.Runs}"-->
                                <controls:CustomDataGrid.Columns>
                                    <DataGridTextColumn Header="Run#" Binding="{Binding RunNumber}" SortDirection="Ascending" >
                                        <DataGridTextColumn.CellStyle>
                                            <Style TargetType="DataGridCell">
                                                <Setter Property="Background" 
                                                    Value="{StaticResource clBr}" />
                                            </Style>
                                        </DataGridTextColumn.CellStyle>
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="{x:Type TextBlock}">
                                                <Setter Property="HorizontalAlignment" Value="Center" />
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Location" Binding="{Binding RunLocation.Description}"/>
                                    <DataGridTextColumn Header="Tire Model" Binding="{Binding TireModelType.Description}"/>
                                    <DataGridTextColumn Header="Car" Binding="{Binding Path=Maneuver}"/>
                                    <DataGridTextColumn Header="RF Tire" Binding="{Binding RFTire.Construction}"/>
                                    <DataGridTextColumn Header="LF Tire" Binding="{Binding LFTire.Construction}"/>
                                    <DataGridTextColumn Header="RR Tire" Binding="{Binding RRTire.Construction}"/>
                                    <DataGridTextColumn Header="RF Tire" Binding="{Binding RFTire.Construction}"/>
                                </controls:CustomDataGrid.Columns>
                                <controls:CustomDataGrid.Resources>
                                    <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="DarkGray"/>
                                </controls:CustomDataGrid.Resources>
                            </controls:CustomDataGrid>
                        </DockPanel>
                    </GroupBox>
                </Grid>
                <DockPanel
                    Background="AliceBlue"
                    Height="Auto"            
                    Margin="10">
                    <GroupBox   IsEnabled="{Binding CurrentTestRequestRun, TargetNullValue=False}"  Header="Test Request - Selected Run Information" Grid.Column="1"  >
                        <DockPanel Margin="5">
                            <Label DockPanel.Dock="Top"  Margin="10,0,0,0">Location:</Label>
                            <ComboBox DockPanel.Dock="Top" 
                                ItemsSource="{Binding Locations}"
                                DisplayMemberPath="Description"
                                SelectedValuePath="LocationID"
                                SelectedItem="{Binding Path=CurrentTestRequestRun.RunLocation}"
                                HorizontalAlignment="Left" Margin="10,0,0,0"
                                Width="250"></ComboBox>
                            
                            <TabControl Background="AliceBlue" Margin="10">
                                <TabItem Header="Tires">
                                    <StackPanel Margin="10" Grid.Column="0">
                                       
                                        <Label >Tire Model Type:</Label>
                                        <ComboBox ItemsSource="{Binding TireTypes}"
                                          DisplayMemberPath="Description"
                                          SelectedValuePath="TireTypeID"
                                          SelectedItem="{Binding Path=CurrentTestRequestRun.TireModelType}"
                                          HorizontalAlignment="Left"
                                          Width="250"></ComboBox>

                                        <Label>Generated Send files will be modifed to correctly support Tire Type selected.</Label>

                            
                                        
                                        <DockPanel  LastChildFill="True" >
                                            <Label DockPanel.Dock="Left">Left Front Tire:</Label>
                                            <Label DockPanel.Dock="Left"  Content="{Binding CurrentTestRequestRun.LFTire.Construction, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left" Margin="0,0,0,0"  Content="{Binding CurrentTestRequestRun.LFTire.Pressure, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left">psi</Label>
                                        </DockPanel >   

                                        <DockPanel  LastChildFill="True" >
                                            <Button Content="Browse"  DockPanel.Dock="Left" VerticalAlignment="Center"/>
                                            <TextBlock HorizontalAlignment="Left" Width="600" Margin="5,1,1,1" Text="{Binding CurrentTestRequestRun.LFTire.TirePath, UpdateSourceTrigger=PropertyChanged}" Background="White"  />
                                          

                                        </DockPanel >

                                        <DockPanel  LastChildFill="True" >
                                            <Label DockPanel.Dock="Left">Right Front Tire:</Label>
                                            <Label DockPanel.Dock="Left"  Content="{Binding CurrentTestRequestRun.RFTire.Construction, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left" Margin="10,0,0,0"  Content="{Binding CurrentTestRequestRun.RFTire.Pressure, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left">psi</Label>
                                        </DockPanel >
                                        <DockPanel LastChildFill="True" >
                                            <Button Content="Browse"  DockPanel.Dock="Left" VerticalAlignment="Center"/>
                                            <TextBlock HorizontalAlignment="Left" Width="600" Margin="5,1,1,1" Text="{Binding CurrentTestRequestRun.RFTire.TirePath, UpdateSourceTrigger=PropertyChanged}" Background="White"  />
                                        </DockPanel >

                                        <DockPanel  LastChildFill="True" >
                                            <Label DockPanel.Dock="Left">Left Rear  Tire:</Label>
                                            <Label DockPanel.Dock="Left"  Content="{Binding CurrentTestRequestRun.LRTire.Construction, UpdateSourceTrigger=PropertyChanged}"></Label>

                                            <Label DockPanel.Dock="Left" Margin="10,0,0,0"  Content="{Binding CurrentTestRequestRun.LRTire.Pressure, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left">psi</Label>
                                        </DockPanel >
                                
                                        <DockPanel  LastChildFill="True" >
                                            <Button Content="Browse"  DockPanel.Dock="Left" VerticalAlignment="Center"/>
                                            <TextBlock HorizontalAlignment="Left" Width="600" Margin="5,1,1,1" Text="{Binding CurrentTestRequestRun.RFTire.TirePath, UpdateSourceTrigger=PropertyChanged}" Background="White"  />
                                        </DockPanel >

                                        <DockPanel  LastChildFill="True" >
                                            <Label DockPanel.Dock="Left">Right Rear  Tire:</Label>
                                            <Label DockPanel.Dock="Left"  Content="{Binding CurrentTestRequestRun.RRTire.Construction, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left" Margin="10,0,0,0"  Content="{Binding CurrentTestRequestRun.RRTire.Pressure, UpdateSourceTrigger=PropertyChanged}"></Label>
                                            <Label DockPanel.Dock="Left">psi</Label>
                                        </DockPanel >
                                 
                                        <DockPanel LastChildFill="True" >
                                            <Button Content="Browse"  DockPanel.Dock="Left" VerticalAlignment="Center"/>
                                            <TextBlock HorizontalAlignment="Left" Width="600" Margin="5,1,1,1" Text="{Binding CurrentTestRequestRun.RRTire.TirePath, UpdateSourceTrigger=PropertyChanged}" Background="White"  />
                                        </DockPanel >
                                        <Button Command="{Binding GenerateSendFile}" Margin="10" Width="300" Content="Generate Send File" />
                                    </StackPanel>
                                </TabItem>
                                <TabItem Header="Telemetry Logs" />
                                <TabItem Header="Comments" />
                            </TabControl>
                        </DockPanel>
                        
                    </GroupBox>
                </DockPanel>
            </DockPanel>
        </Grid>
    </DockPanel>
</Window>
